<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ğŸ› ï¸ Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø´Ø¹Ø§Ø± Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø© Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ | Ù…Ù‡Ù†Ø¯Ø³ Ù…Ø­Ù…Ø¯ Ø­Ù…Ø§Ø¯</title>
  <script src="https://docs.opencv.org/4.8.0/opencv.js"></script>
  <style>
    body { background:#0f1115; color:#e9eef3; font-family:system-ui,Arial; margin:0; }
    h1 { color:#00e0a4; text-align:center; padding:20px 0; }
    main{max-width:1000px;margin:auto;padding:20px;}
    #aiStatus{background:#151923;border:1px solid #2a2f3a;border-radius:8px;padding:12px;text-align:center;margin:16px 0;color:#00e0a4;}
    #dropZone{border:3px dashed #00e0a4;border-radius:16px;padding:60px 20px;text-align:center;cursor:pointer;}
    #dropZone.dragover{background:rgba(0,224,164,0.15);}
    canvas{display:block;margin:20px auto;max-width:100%;height:auto;background:#000;}
    button{background:#00e0a4;color:#02130e;border:none;border-radius:10px;padding:10px 20px;font-weight:700;cursor:pointer;margin:5px;}
    footer{text-align:center;padding:24px;font-size:14px;color:#7a8a9a;border-top:1px solid #2a2f3a;}
    .spin{display:inline-block;animation:spin 1s linear infinite;}
    @keyframes spin{from{transform:rotate(0);}to{transform:rotate(360deg);}}
  </style>
</head>
<body>
  <h1>ğŸ› ï¸ Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø´Ø¹Ø§Ø± Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø© Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</h1>
  <main>
    <div id="aiStatus">ğŸ¤– Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ù…ÙƒØªØ¨Ø© OpenCV...</div>
    <div id="dropZone">ğŸ“¤ Ø§Ø³Ø­Ø¨ Ø§Ù„ØµÙˆØ± Ù‡Ù†Ø§ Ø£Ùˆ Ø§Ø¶ØºØ· Ù„Ù„ØªØ­Ù…ÙŠÙ„</div>
    <canvas id="preview"></canvas>
    <button id="btnProcess">ğŸ”„ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ØµÙˆØ±Ø©</button>
  </main>
  <footer>
    <p>Ø¨Ø±Ù…Ø¬Ø© ÙˆØªØµÙ…ÙŠÙ… <strong>Ø§Ù„Ù…Ù‡Ù†Ø¯Ø³ Ù…Ø­Ù…Ø¯ Ø­Ù…Ø§Ø¯</strong> | <a href="https://www.facebook.com/en.mohamed.nasr" target="_blank" style="color:#00e0a4;text-decoration:none;">ØªØ§Ø¨Ø¹Ù†ÙŠ Ø¹Ù„Ù‰ ÙÙŠØ³Ø¨ÙˆÙƒ</a></p>
  </footer>

  <script>
    (async () => {
      const el = {
        dropZone: document.getElementById('dropZone'),
        aiStatus: document.getElementById('aiStatus'),
        preview: document.getElementById('preview'),
        btnProcess: document.getElementById('btnProcess')
      };

      const state = { sr: null, image: null };

      // Ø§Ù†ØªØ¸Ø§Ø± ØªØ­Ù…ÙŠÙ„ OpenCV
      function waitForCV() {
        return new Promise((resolve, reject) => {
          const check = setInterval(() => {
            if (cv && cv.getBuildInformation) {
              clearInterval(check);
              resolve();
            }
          }, 200);
          setTimeout(() => reject("âŒ ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ OpenCV.js"), 10000);
        });
      }

      try {
        await waitForCV();
        el.aiStatus.textContent = "âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ OpenCV.js Ø¨Ù†Ø¬Ø§Ø­";
      } catch (err) {
        el.aiStatus.textContent = err;
        return;
      }

      // ØªØ­Ù…ÙŠÙ„ Ù†Ù…ÙˆØ°Ø¬ ESPCN
      async function loadESPCN() {
        try {
          el.aiStatus.innerHTML = '<span class="spin">ğŸ”„</span> Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ù†Ù…ÙˆØ°Ø¬ ESPCN_x4.pb...';
          state.sr = new cv.dnn.SuperResolution();
          await state.sr.readModel('https://raw.githubusercontent.com/mohamednasr5/logo/main/ESPCN_x4.pb');
          state.sr.setModel('espcn', 4);
          el.aiStatus.textContent = "âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ù†Ù…ÙˆØ°Ø¬ ESPCN_x4 Ø¨Ù†Ø¬Ø§Ø­ - Ø¬Ø§Ù‡Ø² Ù„ØªØ­Ø³ÙŠÙ† 4K";
        } catch (e) {
          console.error("ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ ESPCN:", e);
          el.aiStatus.textContent = "âš ï¸ ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ù†Ù…ÙˆØ°Ø¬ ESPCN_x4 - Ø³ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ";
          state.sr = null;
        }
      }

      await loadESPCN();

      // ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©
      el.dropZone.addEventListener('click', () => {
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = 'image/*';
        input.onchange = e => handleFile(e.target.files[0]);
        input.click();
      });

      el.dropZone.addEventListener('dragover', e => {
        e.preventDefault();
        el.dropZone.classList.add('dragover');
      });

      el.dropZone.addEventListener('dragleave', () => el.dropZone.classList.remove('dragover'));
      el.dropZone.addEventListener('drop', e => {
        e.preventDefault();
        el.dropZone.classList.remove('dragover');
        const file = e.dataTransfer.files[0];
        if (file) handleFile(file);
      });

      async function handleFile(file) {
        const reader = new FileReader();
        reader.onload = e => {
          const img = new Image();
          img.onload = () => {
            el.preview.width = img.width;
            el.preview.height = img.height;
            const ctx = el.preview.getContext('2d');
            ctx.drawImage(img, 0, 0);
            state.image = img;
            el.aiStatus.textContent = "ğŸ“· ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø© - Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©";
          };
          img.src = e.target.result;
        };
        reader.readAsDataURL(file);
      }

      // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ØµÙˆØ±Ø©
      el.btnProcess.addEventListener('click', async () => {
        if (!state.image) {
          el.aiStatus.textContent = "âš ï¸ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø±ÙØ¹ ØµÙˆØ±Ø© Ø£ÙˆÙ„Ø§Ù‹";
          return;
        }

        el.aiStatus.innerHTML = '<span class="spin">ğŸ”„</span> Ø¬Ø§Ø±Ù Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ØµÙˆØ±Ø©...';

        try {
          const src = cv.imread(el.preview);
          const dst = new cv.Mat();

          if (state.sr) {
            state.sr.upsample(src, dst);
          } else {
            // fallback ØªØ­Ø³ÙŠÙ† Ø¹Ø§Ø¯ÙŠ ÙÙŠ Ø­Ø§Ù„Ø© ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
            cv.resize(src, dst, new cv.Size(src.cols * 2, src.rows * 2), 0, 0, cv.INTER_CUBIC);
          }

          const output = document.createElement('canvas');
          output.width = dst.cols;
          output.height = dst.rows;
          cv.imshow(output, dst);

          el.preview.replaceWith(output);
          el.preview = output;

          src.delete();
          dst.delete();

          el.aiStatus.textContent = "âœ… ØªÙ… ØªØ­Ø³ÙŠÙ† Ø§Ù„ØµÙˆØ±Ø© Ø¨Ù†Ø¬Ø§Ø­!";
        } catch (error) {
          console.error(error);
          el.aiStatus.textContent = "âš ï¸ ÙØ´Ù„ ÙÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ØµÙˆØ±Ø©";
        }
      });
    })();
  </script>
</body>
</html>
