<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ğŸ› ï¸ Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø´Ø¹Ø§Ø± ÙˆØ±ÙØ¹ Ø¬ÙˆØ¯Ø© Ø§Ù„ØµÙˆØ± | Ù…Ù† Ù…Ù‡Ù†Ø¯Ø³ Ù…Ø­Ù…Ø¯ Ø­Ù…Ø§Ø¯</title>
<style>
  :root { --brand:#00e0a4; --bg:#0f1115; --panel:#151923; --text:#e9eef3; }
  body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,Arial}
  header{padding:20px;text-align:center;border-bottom:1px solid #222}
  h1{margin:0 0 8px 0;color:var(--brand);font-weight:700}
  main{max-width:1100px;margin:24px auto;padding:0 16px}
  .card{background:var(--panel);border:1px solid #222;border-radius:14px;padding:16px;margin-bottom:16px}
  .row{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
  label{font-size:14px;opacity:.9}
  input[type="file"]{display:block;width:100%;padding:22px;border:2px dashed var(--brand);border-radius:12px;background:#0c0f14;color:#9fb0c3;text-align:center;cursor:pointer}
  input[type="file"]::file-selector-button{background:var(--brand);color:#02130e;border:none;border-radius:8px;padding:8px 14px;font-weight:700;cursor:pointer;content:"Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±";}
  input[type="file"]::before{content:"ğŸ“¤ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±";display:block;font-size:16px;font-weight:bold;color:var(--brand);margin-bottom:6px}
  input[type="number"],input[type="range"],select{background:#0c0f14;color:var(--text);border:1px solid #2a2f3a;border-radius:10px;padding:8px}
  input[type="range"]{width:180px}
  .btn{background:var(--brand);color:#02130e;border:0;border-radius:10px;padding:10px 16px;font-weight:700;cursor:pointer}
  .btn[disabled]{opacity:.5;cursor:not-allowed}
  .muted{opacity:.8;font-size:13px}
  .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:12px}
  .thumb{background:#0c0f14;border:1px solid #2a2f3a;border-radius:12px;overflow:hidden;padding-bottom:10px}
  .thumb canvas{width:100%;display:block}
  .controls{padding:10px;background:#11171e;border-top:1px solid #2a2f3a;text-align:center}
  .controls label{font-size:12px;display:block;margin-bottom:4px}
  progress{width:100%;height:12px}
  footer{opacity:.85;text-align:center;padding:24px 0;font-size:15px;color:#b4c7d4}
  footer a{color:var(--brand);text-decoration:none;font-weight:bold}
  #popup{position:fixed;inset:0;background:rgba(0,0,0,0.8);display:flex;align-items:center;justify-content:center;z-index:9999;visibility:hidden;opacity:0;transition:.3s;}
  #popup.active{visibility:visible;opacity:1;}
  #popup .box{background:#151923;padding:30px;border-radius:16px;text-align:center;max-width:400px;line-height:1.7;box-shadow:0 0 20px rgba(0,0,0,0.4);}
  #popup h2{color:var(--brand);margin-bottom:10px}
  #popup button{margin-top:15px}
</style>
</head>
<body>
<header>
  <h1>ğŸ› ï¸ Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø´Ø¹Ø§Ø± ÙˆØ±ÙØ¹ Ø¬ÙˆØ¯Ø© Ø§Ù„ØµÙˆØ± | Ù…Ù† Ù…Ù‡Ù†Ø¯Ø³ Ù…Ø­Ù…Ø¯ Ø­Ù…Ø§Ø¯</h1>
  <div class="muted">ÙŠÙ…ÙƒÙ†Ùƒ Ø±ÙØ¹ Ø¹Ø¯Ø¯ 50 ØµÙˆØ±Ø© Ù…Ø¹Ø§Ù‹ | Ù…Ù† Ø£Ø¬Ù„ Ø¹ÙŠÙˆÙ†ÙŠ Ù…ØªØ§Ø¨Ø¹ÙŠÙ†ÙŠ</div>
</header>

<main>
  <div class="card">
    <input id="picker" type="file" accept="image/*" multiple title="Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±" />
    <div class="row" style="margin-top:12px">
      <div>
        <label>Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ù‚Øµ Ø§Ù„Ø¹Ù…ÙˆØ¯ÙŠ:</label><br>
        <select id="vertSide">
          <option value="right">ÙŠÙ…ÙŠÙ†</option>
          <option value="left">ÙŠØ³Ø§Ø±</option>
        </select>
      </div>
      <div>
        <label>Ø¹Ø±Ø¶ Ø§Ù„Ù‚Øµ Ø§Ù„Ø¹Ù…ÙˆØ¯ÙŠ: <span id="vertVal">2</span>%</label><br>
        <div class="row">
          <input id="vertCut" type="range" min="0" max="15" step="0.5" value="2">
          <input id="vertNum" type="number" min="0" max="15" step="0.5" value="2" style="width:70px">
        </div>
      </div>
      <div>
        <label>Ù‚Øµ Ø³ÙÙ„ÙŠ: <span id="bottomVal">0</span>%</label><br>
        <div class="row">
          <input id="bottomCut" type="range" min="0" max="20" step="0.5" value="0">
          <input id="bottomNum" type="number" min="0" max="20" step="0.5" value="0" style="width:70px">
        </div>
      </div>
      <div>
        <label>Ø§Ù„Ù‡Ø¯Ù:</label><br>
        <select id="target">
          <option value="4k">4K (3840Ã—2160)</option>
          <option value="uhd3840">Ø£Ø·ÙˆÙ„ Ø¶Ù„Ø¹ = 3840</option>
          <option value="none">Ø¨Ø¯ÙˆÙ† ØªØ±Ù‚ÙŠØ©</option>
        </select>
      </div>
    </div>
  </div>

  <div class="card row">
    <button class="btn" id="btnProcess">ğŸ”„ ØªÙ†ÙÙŠØ° Ø¹Ù„Ù‰ Ø§Ù„ÙƒÙ„</button>
    <button class="btn" id="btnDownload">â¬‡ï¸ ØªÙ†Ø²ÙŠÙ„ Ø§Ù„ÙƒÙ„ (ØµÙˆØ± Ù…Ù†ÙØµÙ„Ø©)</button>
    <button class="btn" id="btnZip">ğŸ“¦ ØªÙ†Ø²ÙŠÙ„ Ù…Ù„Ù Ù…Ø¶ØºÙˆØ· (ZIP)</button>
    <div class="muted">ÙƒÙ„ ØªØºÙŠÙŠØ± ÙÙŠ Ø§Ù„Ù…Ø¤Ø´Ø±Ø§Øª ÙŠØ­Ø¯Ø« Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© ÙÙˆØ±Ù‹Ø§.</div>
  </div>

  <div class="card">
    <div class="row" style="align-items:center;gap:8px">
      <strong>Ø§Ù„ØªÙ‚Ø¯Ù‘Ù…:</strong>
      <progress id="bar" max="100" value="0"></progress>
      <span id="status" class="muted">Ø¬Ø§Ù‡Ø²</span>
    </div>
  </div>

  <div class="card">
    <h3>ğŸ“¸ Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø§Øª</h3>
    <div id="preview" class="grid"></div>
  </div>
</main>

<footer>
  Ù‡Ø°Ù‡ Ø§Ù„Ø£Ø¯Ø§Ø© Ù…Ù† Ø¨Ø±Ù…Ø¬Ø© ÙˆÙ…Ù„Ùƒ <strong>Ø§Ù„Ù…Ù‡Ù†Ø¯Ø³ Ù…Ø­Ù…Ø¯ Ø­Ù…Ø§Ø¯</strong> â€“ ØªØ§Ø¨Ø¹ÙˆÙ‡ Ø¹Ù„Ù‰ Ø§Ù„ÙÙŠØ³Ø¨ÙˆÙƒ:
  <br>
  ğŸ‘‰ <a href="https://www.facebook.com/en.mohamed.nasr" target="_blank">facebook.com/en.mohamed.nasr</a>
</footer>

<!-- Ù†Ø§ÙØ°Ø© Ø§Ù„Ù‚Ø³Ù… -->
<div id="popup">
  <div class="box">
    <h2>âš ï¸ Ù‚Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</h2>
<p style="font-size:18px;line-height:1.8;text-align:center;color:#fff;">
Ù‚Ø¨Ù„ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù‡Ø°Ù‡ Ø§Ù„Ø£Ø¯Ø§Ø©ØŒ <strong>Ø£ÙÙ‚Ù’Ø³ÙÙ… Ø¨Ø§Ù„Ù„Ù‡ Ø§Ù„Ø¹Ø¸ÙŠÙ…</strong>ØŒ Ø§Ù„Ø°ÙŠ ÙŠØ¹Ù„Ù… Ø§Ù„Ø³Ø± ÙˆØ£Ø®ÙÙ‰ØŒ  
Ø£Ù† Ø£ØªØ§Ø¨Ø¹ Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ù‡Ù†Ø¯Ø³ <strong>Ù…Ø­Ù…Ø¯ Ø­Ù…Ø§Ø¯</strong> Ø¹Ù„Ù‰ ÙÙŠØ³Ø¨ÙˆÙƒ  
(<a href="https://www.facebook.com/en.mohamed.nasr" target="_blank" style="color:#00e0a4;">ØªØ§Ø¨Ø¹ Ù…Ù† Ù‡Ù†Ø§</a>)  
ÙˆØ£Ø´Ù‡Ø¯ Ø§Ù„Ù„Ù‡ Ø£Ù†ÙŠ Ø¥Ù† Ø§Ø³ØªØ®Ø¯Ù…Øª Ù‡Ø°Ù‡ Ø§Ù„Ø£Ø¯Ø§Ø© Ø¯ÙˆÙ† Ù…ØªØ§Ø¨Ø¹Ø©ØŒ Ø£Ùˆ ØªØ§Ø¨Ø¹ØªÙ‡ Ø«Ù… Ø£Ù„ØºÙŠØª Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø¨Ø¹Ø¯ Ø°Ù„ÙƒØŒ  
ÙØ¥Ù†ÙŠ Ø£ÙƒÙˆÙ† Ù‚Ø¯ Ø£Ø®Ù„ÙØª ÙˆØ¹Ø¯ÙŠØŒ ÙˆØ®Ù†Øª Ø£Ù…Ø§Ù†ØªÙŠØŒ ÙˆØ¸Ù„Ù…Øª Ù†ÙØ³ÙŠ.  
<br><br>
ÙˆØ£Ø¹Ù„Ù… Ø£Ù† Ø§Ù„Ù„Ù‡ Ù…Ø·Ù‘Ù„Ø¹ Ø¹Ù„ÙŠÙ‘ ÙÙŠ Ø§Ù„Ø³Ø± ÙˆØ§Ù„Ø¹Ù„Ù†ØŒ  
ÙØ¥Ù† ØµØ¯Ù‚Øª ÙÙŠ Ø¹Ù‡Ø¯ÙŠ ÙÙ„ÙŠØ¨Ø§Ø±ÙƒÙ†ÙŠ Ø§Ù„Ù„Ù‡ ÙÙŠ Ø¹Ù…Ù„ÙŠØŒ  
ÙˆØ¥Ù† Ø®Ø§Ù„ÙØªØŒ ÙØ£Ø³Ø£Ù„ Ø§Ù„Ù„Ù‡ Ø£Ù† ÙŠØ¤Ø¯Ø¨Ù†ÙŠ Ø¨Ø±Ø­Ù…ØªÙ‡ Ù‚Ø¨Ù„ Ø¹Ø¯Ù„Ù‡.  
</p>
    <p>âœ³ï¸ Ø±Ø§Ø¨Ø· Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©: <br>
      <a href="https://www.facebook.com/en.mohamed.nasr" target="_blank" style="color:#00e0a4;font-weight:bold">Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ù…Ù‡Ù†Ø¯Ø³ Ù…Ø­Ù…Ø¯ Ø­Ù…Ø§Ø¯ Ø§Ù„Ø¢Ù†</a>
    </p>
    <label><input type="checkbox" id="agreeBox"> âœ” Ø£Ù‚Ø± ÙˆØ£Ù‚Ø³Ù… Ø¨Ø°Ù„Ùƒ</label><br>
    <button class="btn" id="agreeBtn" disabled>Ø£Ù‚Ø³Ù… ÙˆØ£Ù‚Ø± Ø¨Ø°Ù„Ùƒ âœ…</button>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>
<script>
(() => {
  const picker=document.getElementById('picker');
  const vertCut=document.getElementById('vertCut');
  const bottomCut=document.getElementById('bottomCut');
  const vertNum=document.getElementById('vertNum');
  const bottomNum=document.getElementById('bottomNum');
  const vertVal=document.getElementById('vertVal');
  const bottomVal=document.getElementById('bottomVal');
  const vertSide=document.getElementById('vertSide');
  const targetSel=document.getElementById('target');
  const previewEl=document.getElementById('preview');
  const bar=document.getElementById('bar');
  const status=document.getElementById('status');
  const btnProcess=document.getElementById('btnProcess');
  const btnDownload=document.getElementById('btnDownload');
  const btnZip=document.getElementById('btnZip');

  let files=[],previews=[];

  function clamp(v,min,max){return Math.max(min,Math.min(max,v));}
  function syncRangeNum(range,num,label){
    const setBoth=val=>{
      val=clamp(val,parseFloat(range.min),parseFloat(range.max));
      range.value=num.value=val;label.textContent=val;
      updateGlobalPreviews();
    };
    range.addEventListener('input',()=>setBoth(parseFloat(range.value)));
    num.addEventListener('input',()=>setBoth(parseFloat(num.value)));
  }
  syncRangeNum(vertCut,vertNum,vertVal);
  syncRangeNum(bottomCut,bottomNum,bottomVal);
  [vertSide,targetSel].forEach(el=>el.addEventListener('change',updateGlobalPreviews));

  picker.addEventListener('change',async()=>{
    files=Array.from(picker.files);
    if(!files.length)return;
    previewEl.innerHTML='';previews=[];
    for(let i=0;i<files.length;i++){
      const img=await loadImage(files[i]);
      const c=cropImage(img,getGlobalOptions());
      const div=createPreview(c,files[i].name,i);
      previewEl.appendChild(div);
      previews.push({img,c,div});
    }
  });

  function loadImage(file){
    return new Promise((res,rej)=>{
      const img=new Image();
      img.onload=()=>res(img);
      img.onerror=rej;
      img.src=URL.createObjectURL(file);
    });
  }

  function getGlobalOptions(){
    return{
      verticalPercent:parseFloat(vertNum.value),
      bottomPercent:parseFloat(bottomNum.value),
      side:vertSide.value,
      target:targetSel.value
    };
  }

  function cropImage(img,opt){
    const {verticalPercent,bottomPercent,side}=opt;
    const vpx=verticalPercent/100,bpx=bottomPercent/100;
    const sx=side==='left'?img.width*vpx:0;
    const sw=img.width*(1-vpx);
    const sh=img.height*(1-bpx);
    const c=document.createElement('canvas');
    c.width=sw;c.height=sh;
    const ctx=c.getContext('2d');
    ctx.imageSmoothingQuality='high';
    ctx.drawImage(img,sx,0,sw,sh,0,0,sw,sh);
    return c;
  }

  function drawToCanvas(cv,src){
    const ctx=cv.getContext('2d');
    const scale=Math.min(1,260/src.width);
    cv.width=src.width*scale;
    cv.height=src.height*scale;
    ctx.clearRect(0,0,cv.width,cv.height);
    ctx.drawImage(src,0,0,cv.width,cv.height);
  }

  function createPreview(canvas,name,i){
    const wrap=document.createElement('div');
    wrap.className='thumb';
    const cv=document.createElement('canvas');
    wrap.appendChild(cv);
    drawToCanvas(cv,canvas);

    const controls=document.createElement('div');
    controls.className='controls';
    controls.innerHTML=`
      <label>Ù‚Øµ Ø¹Ù…ÙˆØ¯ÙŠ: <input type="range" min="0" max="15" step="0.5" value="2" class="vcut"></label>
      <label>Ù‚Øµ Ø³ÙÙ„ÙŠ: <input type="range" min="0" max="20" step="0.5" value="0" class="bcut"></label>
      <button class="btn save">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØµÙˆØ±Ø©</button>
    `;
    wrap.appendChild(controls);

    const vcut=controls.querySelector('.vcut');
    const bcut=controls.querySelector('.bcut');
    const saveBtn=controls.querySelector('.save');

    const updateLocal=()=>{
      const img=previews[i]?.img;
      if(!img)return;
      const c=cropImage(img,{
        verticalPercent:parseFloat(vcut.value),
        bottomPercent:parseFloat(bcut.value),
        side:vertSide.value,
        target:targetSel.value
      });
      drawToCanvas(cv,c);
    };
    vcut.addEventListener('input',updateLocal);
    bcut.addEventListener('input',updateLocal);

    saveBtn.addEventListener('click',async()=>{
      const img=previews[i]?.img;
      const c=cropImage(img,{
        verticalPercent:parseFloat(vcut.value),
        bottomPercent:parseFloat(bcut.value),
        side:vertSide.value,
        target:targetSel.value
      });
      const blob=await new Promise(r=>c.toBlob(r,'image/jpeg',0.9));
      saveAs(blob,`mohamed_hammad${i+1}_4K.jpg`);
    });

    return wrap;
  }

  async function updateGlobalPreviews(){
    if(!files.length)return;
    previewEl.querySelectorAll('.thumb').forEach(async (wrap,i)=>{
      const cv=wrap.querySelector('canvas');
      const img=await loadImage(files[i]);
      const c=cropImage(img,getGlobalOptions());
      drawToCanvas(cv,c);
    });
  }

  btnProcess.addEventListener('click',()=>{
    updateGlobalPreviews();
    status.textContent='âœ… ØªÙ… Ø§Ù„ØªÙ†ÙÙŠØ° Ø¹Ù„Ù‰ Ø§Ù„ÙƒÙ„';
  });

  btnDownload.addEventListener('click',async()=>{
    if(!files.length)return alert('Ø§Ø±ÙØ¹ ØµÙˆØ± Ø£ÙˆÙ„Ø§Ù‹');
    for(let i=0;i<files.length;i++){
      const img=await loadImage(files[i]);
      const c=cropImage(img,getGlobalOptions());
      const blob=await new Promise(r=>c.toBlob(r,'image/jpeg',0.9));
      saveAs(blob,`mohamed_hammad${i+1}_4K.jpg`);
      await new Promise(r=>setTimeout(r,300));
    }
    status.textContent='âœ… ØªÙ… ØªÙ†Ø²ÙŠÙ„ ÙƒÙ„ Ø§Ù„ØµÙˆØ± Ø¨Ø´ÙƒÙ„ Ù…Ù†ÙØµÙ„';
  });

  // === ØªÙ†Ø²ÙŠÙ„ ZIP ===
  btnZip.addEventListener('click',async()=>{
    if(files.length<2)return alert('Ø²Ø± Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…Ø¶ØºÙˆØ· ÙŠØ¹Ù…Ù„ ÙÙ‚Ø· Ø¹Ù†Ø¯ Ø±ÙØ¹ Ø£ÙƒØ«Ø± Ù…Ù† ØµÙˆØ±Ø© ÙˆØ§Ø­Ø¯Ø©');
    const zip=new JSZip();
    for(let i=0;i<files.length;i++){
      const img=await loadImage(files[i]);
      const c=cropImage(img,getGlobalOptions());
      const blob=await new Promise(r=>c.toBlob(r,'image/jpeg',0.9));
      zip.file(`mohamed_hammad${i+1}_4K.jpg`,blob);
      bar.value=((i+1)/files.length)*100;
      status.textContent=`ğŸ“¦ Ø¥Ø¶Ø§ÙØ© ${i+1}/${files.length} Ù„Ù„Ù…Ù„Ù Ø§Ù„Ù…Ø¶ØºÙˆØ·...`;
    }
    const zipBlob=await zip.generateAsync({type:'blob'});
    saveAs(zipBlob,'mohamed_hammad_images.zip');
    status.textContent='âœ… ØªÙ… ØªÙ†Ø²ÙŠÙ„ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…Ø¶ØºÙˆØ· Ø¨Ù†Ø¬Ø§Ø­';
  });

  // === Popup Ø§Ù„Ù‚Ø³Ù… ===
  const popup=document.getElementById('popup');
  const agreeBox=document.getElementById('agreeBox');
  const agreeBtn=document.getElementById('agreeBtn');
  if(!localStorage.getItem('agreedToFollow')) popup.classList.add('active');
  agreeBox.addEventListener('change',()=>agreeBtn.disabled=!agreeBox.checked);
  agreeBtn.addEventListener('click',()=>{
    localStorage.setItem('agreedToFollow','true');
    popup.classList.remove('active');
  });
})();
</script>
</body>
</html>
