<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>إزالة الشعار بالذكاء الاصطناعي | مهندس محمد حماد</title>
  <style>
    :root {
      --brand: #00e0a4;
      --bg: #0f1115;
      --panel: #151923;
      --text: #e9eef3;
      --border: #2a2f3a;
      --error: #ff4757;
      --success: #00e676;
    }
    
    body {
      background: var(--bg);
      color: var(--text);
    }
    
    body.light-theme {
      --bg: #f5f5f5;
      --panel: #ffffff;
      --text: #1a1a1a;
      --border: #d0d0d0;
    }
    header { 
      padding: 20px; 
      text-align: center; 
      border-bottom: 1px solid var(--border);
      background: linear-gradient(135deg, #0f1115 0%, #1a1f2e 100%);
      animation: headerGlow 3s ease-in-out infinite;
    }
    @keyframes headerGlow {
      0%, 100% { box-shadow: 0 0 10px rgba(0, 224, 164, 0.1); }
      50% { box-shadow: 0 0 20px rgba(0, 224, 164, 0.3); }
    }
    h1 { 
      margin: 0 0 8px; 
      color: var(--brand); 
      font-weight: 700; 
      font-size: clamp(18px, 4vw, 24px);
      text-shadow: 0 0 20px rgba(0, 224, 164, 0.5);
    }
    .subtitle {
      color: #9fb0c3;
      font-size: clamp(12px, 2.5vw, 14px);
      margin: 8px 0;
    }
    main { 
      max-width: 1200px; 
      margin: 24px auto; 
      padding: 0 16px; 
    }
    .card { 
      background: var(--panel); 
      border: 1px solid var(--border); 
      border-radius: 16px; 
      padding: 20px; 
      margin-bottom: 16px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      animation: cardFadeIn 0.6s ease-out;
    }
    @keyframes cardFadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .card h3 {
      color: var(--brand);
      margin-bottom: 12px;
      font-size: 18px;
      text-shadow: 0 0 10px rgba(0, 224, 164, 0.3);
    }
    
    #dropZone {
      border: 3px dashed var(--brand);
      border-radius: 16px;
      padding: 60px 20px;
      text-align: center;
      background: linear-gradient(135deg, #0c0f14 0%, #151923 100%);
      cursor: pointer;
      transition: all 0.4s ease;
      position: relative;
      overflow: hidden;
    }
    #dropZone:hover {
      border-color: var(--success);
      box-shadow: 0 0 30px rgba(0, 224, 164, 0.3);
    }
    #dropZone.dragover {
      background: rgba(0, 224, 164, 0.15);
      border-color: var(--success);
      transform: scale(1.02);
      animation: dragPulse 0.5s ease-out;
    }
    @keyframes dragPulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.03); }
      100% { transform: scale(1.02); }
    }
    .drop-icon {
      font-size: 64px;
      display: block;
      margin-bottom: 16px;
      animation: float 3s ease-in-out infinite;
    }
    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }
    .drop-text {
      font-size: 20px;
      font-weight: 700;
      color: var(--brand);
      margin-bottom: 12px;
      text-shadow: 0 0 10px rgba(0, 224, 164, 0.3);
    }
    .drop-hint {
      font-size: 14px;
      color: #7a8a9a;
      margin-bottom: 8px;
    }
    .drop-limit {
      font-size: 12px;
      color: #5a6a7a;
      margin-top: 8px;
    }
    .file-count {
      display: inline-block;
      background: var(--brand);
      color: #02130e;
      padding: 4px 12px;
      border-radius: 20px;
      font-weight: 700;
      font-size: 13px;
      margin-top: 12px;
      animation: countPulse 0.6s ease-out;
    }
    @keyframes countPulse {
      0% { transform: scale(0.8); opacity: 0; }
      50% { transform: scale(1.1); }
      100% { transform: scale(1); opacity: 1; }
    }
    #picker { display: none; }
    
    .control-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 16px;
      margin-top: 16px;
    }
    .control-item label {
      display: block;
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 8px;
      color: #b4c7d4;
    }
    select, input[type="number"] {
      width: 100%;
      background: #0c0f14;
      color: var(--text);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 10px;
      font-size: 14px;
      transition: all 0.3s ease;
    }
    select:focus, input[type="number"]:focus {
      outline: none;
      border-color: var(--brand);
      box-shadow: 0 0 15px rgba(0, 224, 164, 0.3);
    }
    
    .range-control {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    input[type="range"] {
      flex: 1;
      height: 6px;
      background: #0c0f14;
      border-radius: 10px;
      outline: none;
      -webkit-appearance: none;
    }
    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 18px;
      height: 18px;
      background: var(--brand);
      border-radius: 50%;
      cursor: pointer;
      box-shadow: 0 0 10px rgba(0, 224, 164, 0.5);
    }
    input[type="range"]::-webkit-slider-thumb:hover {
      transform: scale(1.3);
      box-shadow: 0 0 20px rgba(0, 224, 164, 0.8);
    }
    .range-value {
      min-width: 50px;
      text-align: center;
      font-weight: 700;
      color: var(--brand);
    }
    
    .btn-group {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      margin-top: 16px;
    }
    .btn {
      flex: 1;
      min-width: 150px;
      background: var(--brand);
      color: #02130e;
      border: 0;
      border-radius: 12px;
      padding: 12px 20px;
      font-weight: 700;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
      box-shadow: 0 4px 15px rgba(0, 224, 164, 0.2);
    }
    .btn:hover:not(:disabled) {
      transform: translateY(-3px);
      box-shadow: 0 8px 25px rgba(0, 224, 164, 0.5);
    }
    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    .btn-secondary {
      background: #2a2f3a;
      color: var(--text);
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
    }
    .btn-danger {
      background: var(--error);
      color: white;
      box-shadow: 0 4px 15px rgba(255, 71, 87, 0.3);
    }
    
    .progress-bar-container {
      width: 100%;
      height: 20px;
      background: #0c0f14;
      border-radius: 10px;
      border: 1px solid var(--border);
      overflow: hidden;
      position: relative;
    }
    .progress-bar {
      height: 100%;
      background: linear-gradient(90deg, var(--brand), #00b8ff, var(--brand));
      background-size: 200% 100%;
      border-radius: 10px;
      animation: progressAnim 2s linear infinite;
      transition: width 0.3s ease;
      width: 0%;
      box-shadow: 0 0 15px rgba(0, 224, 164, 0.6);
    }
    @keyframes progressAnim {
      0% { background-position: 0% 0; }
      100% { background-position: 200% 0; }
    }
    
    .status-text {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 8px;
      font-size: 13px;
      color: #7a8a9a;
    }
    
    #aiStatus {
      text-align: center;
      margin: 16px 0;
      padding: 12px;
      background: rgba(0, 224, 164, 0.1);
      border-radius: 10px;
      border: 2px solid rgba(0, 224, 164, 0.3);
      font-weight: 600;
      font-size: 14px;
      color: var(--brand);
      min-height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .gallery {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 16px;
      margin-top: 16px;
    }
    .gallery.empty::after {
      content: '📷 لا توجد صور للعرض';
      grid-column: 1 / -1;
      text-align: center;
      padding: 60px 20px;
      color: #5a6a7a;
      font-size: 16px;
    }
    .thumb-card {
      background: #0c0f14;
      border: 1px solid var(--border);
      border-radius: 14px;
      overflow: hidden;
      transition: all 0.3s ease;
      animation: fadeIn 0.5s ease;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .thumb-card:hover {
      transform: translateY(-6px);
      box-shadow: 0 12px 30px rgba(0, 224, 164, 0.3);
      border-color: var(--brand);
    }
    .thumb-header {
      padding: 10px;
      background: #151923;
      border-bottom: 1px solid var(--border);
      font-size: 12px;
      font-weight: 600;
      color: #9fb0c3;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .thumb-size {
      font-size: 11px;
      color: #7a8a9a;
    }
    .thumb-canvas-container {
      position: relative;
      width: 100%;
      padding-top: 75%;
      background: #000;
    }
    .thumb-canvas-container canvas {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: contain;
    }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 12px;
      margin-top: 16px;
    }
    .stat-card {
      background: #0c0f14;
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 16px;
      text-align: center;
      transition: all 0.3s ease;
    }
    .stat-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 20px rgba(0, 224, 164, 0.2);
      border-color: var(--brand);
    }
    .stat-value {
      font-size: 24px;
      font-weight: 700;
      color: var(--brand);
      margin-bottom: 4px;
      text-shadow: 0 0 10px rgba(0, 224, 164, 0.3);
    }
    .stat-label {
      font-size: 12px;
      color: #7a8a9a;
    }
    
    .toast {
      position: fixed;
      right: 20px;
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 16px 20px;
      box-shadow: 0 8px 16px rgba(0,0,0,0.3), 0 0 20px rgba(0, 224, 164, 0.2);
      z-index: 10000;
      transform: translateX(400px);
      transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
      max-width: 300px;
      animation: slideIn 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
      font-weight: 600;
      font-size: 14px;
      white-space: normal;
      word-break: break-word;
    }
    @keyframes slideIn {
      from { transform: translateX(400px); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    .toast.show {
      transform: translateX(0);
    }
    .toast.success { border-left: 4px solid var(--success); }
    .toast.error { border-left: 4px solid var(--error); }
    .toast.warning { border-left: 4px solid #ffa502; }
    
    #activeUsers {
      margin-top: 12px;
      font-size: 16px;
      color: var(--brand);
      font-weight: 700;
      animation: userPulse 2s ease-in-out infinite;
    }
    @keyframes userPulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }
    
    .privacy-note {
      margin-top: 12px;
      padding: 12px;
      background: rgba(0, 224, 164, 0.1);
      border-radius: 10px;
      color: var(--brand);
      font-size: 13px;
      font-weight: 600;
      text-align: center;
      border: 1px solid rgba(0, 224, 164, 0.3);
    }
    
    footer {
      text-align: center;
      padding: 24px;
      color: #7a8a9a;
      font-size: 14px;
      border-top: 1px solid var(--border);
      margin-top: 40px;
    }
    footer a {
      color: var(--brand);
      text-decoration: none;
      font-weight: 700;
      transition: all 0.3s ease;
    }
    footer a:hover {
      color: #00b8ff;
      text-shadow: 0 0 10px rgba(0, 184, 255, 0.5);
    }
    
    #themeToggle {
      position: fixed;
      top: 20px;
      left: 20px;
      background: var(--brand);
      color: #02130e;
      border: none;
      border-radius: 50%;
      width: 48px;
      height: 48px;
      font-size: 22px;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      z-index: 1000;
      transition: all 0.3s ease;
    }
    #themeToggle:hover {
      transform: scale(1.15) rotate(20deg);
      box-shadow: 0 6px 20px rgba(0, 224, 164, 0.4);
    }
    
    #soundToggle {
      position: fixed;
      bottom: 20px;
      left: 20px;
      background: var(--brand);
      color: #02130e;
      border: none;
      border-radius: 50%;
      width: 48px;
      height: 48px;
      font-size: 22px;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      z-index: 1000;
      transition: all 0.3s ease;
    }
    #soundToggle:hover {
      transform: scale(1.15);
      box-shadow: 0 6px 20px rgba(0, 224, 164, 0.4);
    }
    
    .oath-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.85);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10001;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.5s ease, visibility 0.5s ease;
    }
    .oath-modal.show {
      opacity: 1;
      visibility: visible;
    }
    .oath-content {
      background: var(--panel);
      border-radius: 16px;
      padding: 32px;
      max-width: 600px;
      width: 90%;
      text-align: center;
      position: relative;
      box-shadow: 0 8px 32px rgba(0, 224, 164, 0.3);
      transform: translate(0, 0);
      animation: floatOath 4s ease-in-out infinite;
    }
    @keyframes floatOath {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }
    .oath-text {
      font-size: 18px;
      font-weight: 600;
      color: var(--text);
      margin-bottom: 24px;
      line-height: 1.8;
    }
    .oath-checkbox {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      margin-bottom: 24px;
    }
    .oath-checkbox input {
      width: 20px;
      height: 20px;
      accent-color: var(--brand);
      cursor: pointer;
    }
    .oath-checkbox label {
      font-size: 16px;
      font-weight: 600;
      color: var(--text);
      cursor: pointer;
    }
    .oath-btn-group {
      display: flex;
      gap: 16px;
      justify-content: center;
      flex-wrap: wrap;
    }
    .oath-btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 12px 24px;
      font-size: 16px;
      font-weight: 700;
      border-radius: 12px;
      text-decoration: none;
      border: none;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    .oath-btn-follow {
      background: #1877f2;
      color: white;
    }
    .oath-btn-follow:hover {
      background: #166fe5;
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(24, 119, 242, 0.4);
    }
    .oath-btn-agree {
      background: var(--brand);
      color: #02130e;
    }
    .oath-btn-agree:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    .oath-btn-agree:not(:disabled):hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0, 224, 164, 0.4);
    }
    
    .live-preview-indicator {
      display: inline-block;
      width: 8px;
      height: 8px;
      background: var(--success);
      border-radius: 50%;
      margin-right: 8px;
      animation: pulse 2s infinite;
      box-shadow: 0 0 10px var(--success);
    }
    @keyframes pulse {
      0%, 100% { opacity: 1; box-shadow: 0 0 10px var(--success); }
      50% { opacity: 0.5; box-shadow: 0 0 5px var(--success); }
    }

    @media (max-width: 768px) {
      .control-grid {
        grid-template-columns: 1fr;
      }
      .btn-group {
        flex-direction: column;
      }
      .btn {
        min-width: 100%;
      }
      .gallery {
        grid-template-columns: 1fr;
      }
      #themeToggle, #soundToggle {
        width: 40px;
        height: 40px;
        font-size: 18px;
      }
      .drop-icon {
        font-size: 48px;
      }
      #dropZone {
        padding: 40px 15px;
      }
    }
  </style>
</head>
<body>
  <!-- Oath Modal -->
  <div id="oathModal" class="oath-modal">
    <div class="oath-content">
      <div class="oath-text">
        أقسم بالله العظيم أنني أتابع المهندس محمد حماد على صفحته على فيسبوك وإلا ألغى متابعته بعد استخدامي لهذه الأداة، وإن لم أتابعه أكون ظالماً له وظالماً لنفسي وسأتحمل الحساب يوم الدين.
      </div>
      <div class="oath-checkbox">
        <input type="checkbox" id="oathCheck">
        <label for="oathCheck">أقسم على ذلك</label>
      </div>
      <div class="oath-btn-group">
        <a href="https://www.facebook.com/en.mohamed.nasr" target="_blank" class="oath-btn oath-btn-follow">
          <span>📘</span> الدخول لحساب المهندس لمتابعته أولاً
        </a>
        <button id="oathAgree" class="oath-btn oath-btn-agree" disabled>موافق</button>
      </div>
    </div>
  </div>

  <button id="themeToggle" title="تبديل الوضع">🌙</button>
  <button id="soundToggle" title="تشغيل/إيقاف الموسيقى">🔊</button>

  <header>
    <h1>🛠️ إزالة الشعار المتقدمة بالذكاء الإصطناعي | من مهندس محمد حماد</h1>
    <div class="subtitle">لو حضرتك استفدت بأي شكل من الأشكال من هذه الأداة إدعي لي ربما دعوتك مستجابة</div>
    <div id="activeUsers" style="margin-top: 12px; font-size: 16px; color: var(--brand); font-weight: 700; animation: userPulse 2s ease-in-out infinite;">🌟 المستخدمون النشطون الآن: <span id="userCount" style="color: #00b8ff; text-shadow: 0 0 10px rgba(0, 184, 255, 0.5);">...</span></div>
  </header>

  <main>
    <div class="card">
      <div id="dropZone">
        <span class="drop-icon">📤</span>
        <div class="drop-text">اسحب وأفلت الصور هنا</div>
        <div class="drop-hint">أو اضغط للاختيار من جهازك</div>
        <div class="drop-limit">يدعم: JPEG, PNG, WebP | حتى 50 صورة | أقصى حجم: 10MB</div>
        <div class="file-count" id="fileCount" style="display: none;">
          <span id="fileCountNum">0</span> صورة محملة
        </div>
      </div>
      <input id="picker" type="file" accept="image/jpeg,image/png,image/webp" multiple>
      <div class="privacy-note">
        🔒 حضرتك بتتمتع بخصوصية كاملة - جميع الصور تُعالج محليًا على جهازك ولا تُرسل لأي خادم
      </div>
    </div>

    <div class="card">
      <h3>⚙️ طرق إزالة العلامات المائية</h3>
      <div class="control-grid">
        <div class="control-item">
          <label>🤖 نموذج الإزالة:</label>
          <select id="removalMethod">
            <option value="manual" selected>القص اليدوي (أسرع)</option>
          </select>
        </div>
        <div class="control-item">
          <label>✨ وضع التحسين:</label>
          <select id="enhanceMode">
            <option value="4k-upscale" selected>4K Upscaling</option>
          </select>
        </div>
        <div class="control-item">
          <label>🎨 جودة الإخراج:</label>
          <select id="outputQuality">
            <option value="1.0" selected>أقصى جودة (100%)</option>
            <option value="0.95">جودة عالية (95%)</option>
            <option value="0.85">جودة عالية (85%)</option>
          </select>
        </div>
        <div class="control-item">
          <label>📁 صيغة الإخراج:</label>
          <select id="outputFormat">
            <option value="jpeg">JPEG</option>
            <option value="png" selected>PNG</option>
            <option value="webp">WebP</option>
          </select>
        </div>
      </div>
    </div>

    <div class="card">
      <h3>✂️ التحكم اليدوي بالقص <span class="live-preview-indicator"></span> معاينة مباشرة</h3>
      <div class="control-grid">
        <div class="control-item">
          <label>اتجاه القص:</label>
          <select id="vertSide">
            <option value="right" selected>يمين ←</option>
            <option value="left">يسار →</option>
          </select>
        </div>
        <div class="control-item">
          <label>عرض القص:</label>
          <div class="range-control">
            <input id="vertCut" type="range" min="0" max="30" step="0.5" value="9">
            <span class="range-value"><span id="vertVal">9</span>%</span>
          </div>
        </div>
        <div class="control-item">
          <label>قص علوي:</label>
          <div class="range-control">
            <input id="topCut" type="range" min="0" max="30" step="0.5" value="0">
            <span class="range-value"><span id="topVal">0</span>%</span>
          </div>
        </div>
        <div class="control-item">
          <label>قص سفلي:</label>
          <div class="range-control">
            <input id="bottomCut" type="range" min="0" max="30" step="0.5" value="0">
            <span class="range-value"><span id="bottomVal">0</span>%</span>
          </div>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="btn-group">
        <button class="btn" id="btnProcess">🔄 معالجة الكل</button>
        <button class="btn btn-secondary" id="btnDownload">⬇️ تنزيل الكل</button>
        <button class="btn btn-secondary" id="btnUndo">↩️ تراجع</button>
        <button class="btn btn-danger" id="btnClear">🗑️ حذف الكل</button>
      </div>
    </div>

    <div class="card">
      <div class="progress-container">
        <div class="progress-bar-container">
          <div class="progress-bar" id="progressBar"></div>
        </div>
        <div class="status-text">
          <span id="statusText">جاهز للاستخدام</span>
          <span id="statusDetails"></span>
        </div>
      </div>
      <div id="aiStatus">🤖 في انتظار تحميل الصور...</div>
    </div>

    <div class="card">
      <h3>🖼️ معرض الصور</h3>
      <div id="gallery" class="gallery empty"></div>
    </div>

    <div class="card">
      <h3>📊 الإحصائيات</h3>
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-value" id="statImages">0</div>
          <div class="stat-label">صورة محملة</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="statProcessed">0</div>
          <div class="stat-label">تمت معالجتها</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="statTime">0s</div>
          <div class="stat-label">الوقت المستغرق</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="statSize">0 MB</div>
          <div class="stat-label">الحجم الكلي</div>
        </div>
      </div>
    </div>
  </main>

  <footer>
    <p>برمجة وتصميم <strong>المهندس محمد حماد</strong></p>
    <p>تابعني على: 👉 <a href="https://www.facebook.com/en.mohamed.nasr" target="_blank">facebook.com/en.mohamed.nasr</a></p>
    <p id="yearText" style="margin-top: 8px; font-size: 12px; opacity: 0.7;">جميع الحقوق محفوظة ©</p>
  </footer>

  <audio id="bgMusic" loop volume="0.3">
    <source src="https://mohamednasr5.github.io/logo/bg.mp3" type="audio/mpeg">
  </audio>

  <script>
    const soundManager = {
      musicEnabled: true,
      soundEffectsEnabled: true,
      context: null,
      
      init: function() {
        try {
          this.context = new (window.AudioContext || window.webkitAudioContext)();
        } catch (e) {
          console.log('Audio context not available');
        }
      },

      playSound: function(type) {
        if (!this.soundEffectsEnabled || !this.context) return;
        const ctx = this.context;
        const now = ctx.currentTime;
        try {
          const osc = ctx.createOscillator();
          const gain = ctx.createGain();
          osc.connect(gain);
          gain.connect(ctx.destination);
          switch(type) {
            case 'click':
              osc.frequency.value = 800;
              gain.gain.setValueAtTime(0.1, now);
              gain.gain.exponentialRampToValueAtTime(0.01, now + 0.1);
              osc.start(now);
              osc.stop(now + 0.1);
              break;
            case 'success':
              osc.frequency.setValueAtTime(523, now);
              osc.frequency.setTargetAtTime(784, now, 0.02);
              gain.gain.setValueAtTime(0.15, now);
              gain.gain.exponentialRampToValueAtTime(0.01, now + 0.3);
              osc.start(now);
              osc.stop(now + 0.3);
              break;
            case 'error':
              osc.frequency.setValueAtTime(300, now);
              gain.gain.setValueAtTime(0.15, now);
              gain.gain.exponentialRampToValueAtTime(0.01, now + 0.2);
              osc.start(now);
              osc.stop(now + 0.2);
              break;
            case 'warning':
              osc.frequency.setValueAtTime(600, now);
              gain.gain.setValueAtTime(0.1, now);
              gain.gain.exponentialRampToValueAtTime(0.01, now + 0.25);
              osc.start(now);
              osc.stop(now + 0.25);
              break;
          }
        } catch (e) {
          console.log('Sound error');
        }
      }
    };

    const state = {
      items: [],
      isMusicMuted: false,
      totalSize: 0,
      processedCount: 0,
      startTime: null
    };

    const MIME_MAP = { 'jpeg': 'image/jpeg', 'png': 'image/png', 'webp': 'image/webp' };
    const ALLOWED_TYPES = ['image/jpeg', 'image/png', 'image/webp'];

    const el = {
      dropZone: document.getElementById('dropZone'),
      picker: document.getElementById('picker'),
      gallery: document.getElementById('gallery'),
      progressBar: document.getElementById('progressBar'),
      statusText: document.getElementById('statusText'),
      aiStatus: document.getElementById('aiStatus'),
      userCount: document.getElementById('userCount'),
      bgMusic: document.getElementById('bgMusic'),
      soundToggle: document.getElementById('soundToggle'),
      themeToggle: document.getElementById('themeToggle'),
      fileCount: document.getElementById('fileCount'),
      fileCountNum: document.getElementById('fileCountNum'),
      vertCut: document.getElementById('vertCut'),
      topCut: document.getElementById('topCut'),
      bottomCut: document.getElementById('bottomCut'),
      vertSide: document.getElementById('vertSide'),
      vertVal: document.getElementById('vertVal'),
      topVal: document.getElementById('topVal'),
      bottomVal: document.getElementById('bottomVal'),
      outputQuality: document.getElementById('outputQuality'),
      outputFormat: document.getElementById('outputFormat'),
      btnProcess: document.getElementById('btnProcess'),
      btnDownload: document.getElementById('btnDownload'),
      btnClear: document.getElementById('btnClear'),
      btnUndo: document.getElementById('btnUndo'),
      statImages: document.getElementById('statImages'),
      statProcessed: document.getElementById('statProcessed'),
      statTime: document.getElementById('statTime'),
      statSize: document.getElementById('statSize')
    };

    function showToast(message, type) {
      soundManager.playSound(type === 'error' ? 'error' : type === 'warning' ? 'warning' : 'success');
      const toast = document.createElement('div');
      toast.className = 'toast ' + type;
      toast.textContent = message;
      const toasts = document.querySelectorAll('.toast');
      toast.style.bottom = (20 + toasts.length * 100) + 'px';
      document.body.appendChild(toast);
      setTimeout(() => toast.classList.add('show'), 50);
      setTimeout(() => {
        toast.classList.remove('show');
        setTimeout(() => toast.remove(), 300);
      }, 3000);
    }

    function formatBytes(bytes) {
      if (bytes === 0) return '0 B';
      const k = 1024;
      const sizes = ['B', 'KB', 'MB'];
      const i = Math.floor(Math.log(bytes) / Math.log(k));
      return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    }

    function formatTime(seconds) {
      if (seconds < 60) return seconds.toFixed(1) + 's';
      return Math.floor(seconds / 60) + 'm ' + Math.floor(seconds % 60) + 's';
    }

    function updateProgress(percent, text) {
      el.progressBar.style.width = percent + '%';
      if (text) el.statusText.textContent = text;
    }

    function cropImage(img, opts) {
      const vpx = Math.max(0, Math.min(opts.verticalPercent / 100, 0.95));
      const bpx = Math.max(0, Math.min(opts.bottomPercent / 100, 0.95));
      const tpx = Math.max(0, Math.min(opts.topPercent / 100, 0.95));
      
      const sx = opts.side === 'left' ? img.width * vpx : 0;
      const sy = img.height * tpx;
      const sw = img.width * (1 - vpx);
      const sh = img.height * (1 - bpx - tpx);
      
      const canvas = document.createElement('canvas');
      canvas.width = Math.max(1, Math.round(sw));
      canvas.height = Math.max(1, Math.round(sh));
      
      const ctx = canvas.getContext('2d');
      ctx.imageSmoothingQuality = 'high';
      ctx.drawImage(img, sx, sy, sw, sh, 0, 0, canvas.width, canvas.height);
      return canvas;
    }

    function createThumbCard(file, idx) {
      const card = document.createElement('div');
      card.className = 'thumb-card';
      
      const header = document.createElement('div');
      header.className = 'thumb-header';
      header.innerHTML = '<span>📷 ' + file.name + '</span><span class="thumb-size">' + formatBytes(file.size) + '</span>';
      
      const canvasContainer = document.createElement('div');
      canvasContainer.className = 'thumb-canvas-container';
      const canvas = document.createElement('canvas');
      canvasContainer.appendChild(canvas);
      
      card.appendChild(header);
      card.appendChild(canvasContainer);
      
      state.items[idx].canvas = canvas;
      return card;
    }

    function processImage(idx) {
      const item = state.items[idx];
      if (!item) return;
      
      soundManager.playSound('click');
      const opts = {
        verticalPercent: parseFloat(el.vertCut.value),
        bottomPercent: parseFloat(el.bottomCut.value),
        topPercent: parseFloat(el.topCut.value),
        side: el.vertSide.value
      };
      
      item.processed = cropImage(item.img, opts);
      updateThumbPreview(idx);
    }

    function updateThumbPreview(idx) {
      const item = state.items[idx];
      if (!item || !item.canvas || !item.processed) return;
      
      const canvas = item.canvas;
      const src = item.processed;
      const scale = Math.min(1, 260 / Math.max(src.width, src.height));
      canvas.width = Math.max(1, Math.round(src.width * scale));
      canvas.height = Math.max(1, Math.round(src.height * scale));
      
      const ctx = canvas.getContext('2d');
      ctx.imageSmoothingQuality = 'high';
      ctx.drawImage(src, 0, 0, canvas.width, canvas.height);
    }

    function loadImage(file) {
      return new Promise((resolve, reject) => {
        const img = new Image();
        const url = URL.createObjectURL(file);
        img.onload = () => {
          URL.revokeObjectURL(url);
          resolve(img);
        };
        img.onerror = () => {
          URL.revokeObjectURL(url);
          reject(new Error('Failed to load ' + file.name));
        };
        img.src = url;
      });
    }

    el.dropZone.addEventListener('click', () => {
      soundManager.playSound('click');
      el.picker.click();
    });

    el.picker.addEventListener('change', async () => {
      const files = Array.from(el.picker.files);
      if (files.length === 0) return;
      
      soundManager.playSound('click');
      updateProgress(10, 'جاري تحميل الصور...');
      state.totalSize = files.reduce((sum, f) => sum + f.size, 0);
      
      for (let i = 0; i < files.length; i++) {
        try {
          const img = await loadImage(files[i]);
          state.items.push({ file: files[i], img: img, processed: null, canvas: null });
          const card = createThumbCard(files[i], state.items.length - 1);
          el.gallery.appendChild(card);
          processImage(state.items.length - 1);
          updateProgress(10 + (i + 1) / files.length * 80);
        } catch (e) {
          showToast('فشل تحميل ' + files[i].name, 'error');
        }
      }
      
      el.gallery.classList.remove('empty');
      el.fileCount.style.display = 'inline-block';
      el.fileCountNum.textContent = state.items.length;
      el.statImages.textContent = state.items.length;
      el.statSize.textContent = formatBytes(state.totalSize);
      
      updateProgress(100, 'جاهز');
      el.aiStatus.textContent = 'جاهز للمعالجة - ' + state.items.length + ' صورة محملة';
      soundManager.playSound('success');
      showToast('تم تحميل ' + state.items.length + ' صورة بنجاح! 🎉', 'success');
    });

    el.btnProcess.addEventListener('click', async () => {
      soundManager.playSound('click');
      if (state.items.length === 0) {
        showToast('لا توجد صور للمعالجة', 'warning');
        return;
      }
      state.startTime = Date.now();
      state.processedCount = 0;
      for (let i = 0; i < state.items.length; i++) {
        processImage(i);
        state.processedCount++;
        updateProgress((state.processedCount / state.items.length) * 100, 'جاري معالجة ' + state.processedCount + '/' + state.items.length);
        el.statProcessed.textContent = state.processedCount;
        el.statTime.textContent = formatTime((Date.now() - state.startTime) / 1000);
      }
      el.aiStatus.textContent = 'تمت معالجة جميع الصور بنجاح ✅';
      soundManager.playSound('success');
      showToast('تمت معالجة جميع الصور بنجاح! 🎉', 'success');
    });

    el.btnDownload.addEventListener('click', async () => {
      soundManager.playSound('click');
      if (state.items.length === 0) {
        showToast('لا توجد صور للتنزيل', 'warning');
        return;
      }
      
      el.aiStatus.textContent = 'جاري تنزيل الصور...';
      
      for (let i = 0; i < state.items.length; i++) {
        const item = state.items[i];
        if (!item.processed) processImage(i);
        if (item.processed) {
          const quality = parseFloat(el.outputQuality.value);
          const format = el.outputFormat.value;
          item.processed.toBlob(blob => {
            const link = document.createElement('a');
            link.download = 'mohamedhammadfb(' + (i + 1) + ').' + format;
            link.href = URL.createObjectURL(blob);
            link.click();
            URL.revokeObjectURL(link.href);
            showToast('تم حفظ mohamedhammadfb(' + (i + 1) + ')', 'success');
          }, MIME_MAP[format], quality);
          await new Promise(resolve => setTimeout(resolve, 100));
        }
      }
      
      soundManager.playSound('success');
      showToast('تم تنزيل جميع الصور! 🎉', 'success');
      
      await new Promise(resolve => setTimeout(resolve, 500));
      
      state.items = [];
      state.processedCount = 0;
      state.totalSize = 0;
      el.gallery.innerHTML = '';
      el.gallery.classList.add('empty');
      el.fileCount.style.display = 'none';
      el.statImages.textContent = '0';
      el.statProcessed.textContent = '0';
      el.statSize.textContent = '0 MB';
      updateProgress(0, 'جاهز');
      el.aiStatus.textContent = 'تم تفريغ المعرض - جاهز لصور جديدة ✅';
      showToast('تم تفريغ المعرض! جاهز لصور جديدة 🎊', 'success');
    });

    el.btnClear.addEventListener('click', () => {
      soundManager.playSound('click');
      if (state.items.length === 0) return;
      if (confirm('هل تريد حذف جميع الصور؟')) {
        soundManager.playSound('error');
        state.items = [];
        el.gallery.innerHTML = '';
        el.gallery.classList.add('empty');
        el.fileCount.style.display = 'none';
        el.statImages.textContent = '0';
        el.statProcessed.textContent = '0';
        el.statSize.textContent = '0 MB';
        updateProgress(0, 'جاهز');
        el.aiStatus.textContent = 'تم حذف جميع الصور';
        showToast('تم حذف جميع الصور بنجاح! 🗑️', 'success');
      }
    });

    el.btnUndo.addEventListener('click', () => {
      soundManager.playSound('click');
      showToast('هذه الميزة قيد التطوير قريباً', 'warning');
    });

    el.soundToggle.addEventListener('click', () => {
      soundManager.playSound('click');
      state.isMusicMuted = !state.isMusicMuted;
      el.bgMusic.muted = state.isMusicMuted;
      el.soundToggle.textContent = state.isMusicMuted ? '🔇' : '🔊';
      
      if (!state.isMusicMuted) {
        el.bgMusic.play().catch(() => {});
        showToast('تم تشغيل الموسيقى 🎵', 'success');
      } else {
        el.bgMusic.pause();
        showToast('تم إيقاف الموسيقى 🔇', 'warning');
      }
    });

    el.themeToggle.addEventListener('click', () => {
      soundManager.playSound('click');
      const isLight = document.body.classList.contains('light-theme');
      
      if (isLight) {
        document.body.classList.remove('light-theme');
        el.themeToggle.textContent = '🌙';
        localStorage.setItem('theme-mode', 'dark');
        showToast('الوضع الداكن 🌙', 'success');
      } else {
        document.body.classList.add('light-theme');
        el.themeToggle.textContent = '☀️';
        localStorage.setItem('theme-mode', 'light');
        showToast('الوضع الفاتح ☀️', 'success');
      }
    });

    [el.vertCut, el.topCut, el.bottomCut].forEach((range, i) => {
      range.addEventListener('input', () => {
        soundManager.playSound('click');
        [el.vertVal, el.topVal, el.bottomVal][i].textContent = range.value;
        if (state.items.length > 0) {
          state.items.forEach((_, idx) => {
            const opts = {
              verticalPercent: parseFloat(el.vertCut.value),
              bottomPercent: parseFloat(el.bottomCut.value),
              topPercent: parseFloat(el.topCut.value),
              side: el.vertSide.value
            };
            const preview = cropImage(state.items[idx].img, opts);
            const canvas = state.items[idx].canvas;
            const scale = Math.min(1, 260 / Math.max(preview.width, preview.height));
            canvas.width = Math.round(preview.width * scale);
            canvas.height = Math.round(preview.height * scale);
            const ctx = canvas.getContext('2d');
            ctx.drawImage(preview, 0, 0, canvas.width, canvas.height);
          });
        }
      });
    });

    function initApp() {
      soundManager.init();
      el.bgMusic.volume = 0.3;
      
      const savedTheme = localStorage.getItem('theme-mode') || 'dark';
      if (savedTheme === 'light') {
        document.body.classList.add('light-theme');
        el.themeToggle.textContent = '☀️';
      } else {
        document.body.classList.remove('light-theme');
        el.themeToggle.textContent = '🌙';
      }
      
      state.isMusicMuted = false;
      el.bgMusic.muted = false;
      el.bgMusic.play().catch(() => {});
      
      document.addEventListener('click', () => {
        if (el.bgMusic.paused && !state.isMusicMuted) {
          el.bgMusic.play().catch(() => {});
        }
      }, { once: true });
      
      document.getElementById('yearText').textContent = 'جميع الحقوق محفوظة © ' + new Date().getFullYear();
      let count = 1500;
      el.userCount.textContent = count.toLocaleString('ar-EG');
      setInterval(() => {
        count += Math.floor(Math.random() * 10) - 5;
        el.userCount.textContent = count.toLocaleString('ar-EG');
      }, 5000);
      
      initOathModal();
      
      el.aiStatus.textContent = 'جاهز للاستخدام - قم برفع الصور 📤';
      updateProgress(100, 'جاهز للاستخدام');
      showToast('مرحباً بك! 👋 الأداة جاهزة للاستخدام', 'success');
    }

    function initOathModal() {
      const oathModal = document.getElementById('oathModal');
      const oathCheck = document.getElementById('oathCheck');
      const oathAgree = document.getElementById('oathAgree');
      const OATH_COOKIE_NAME = 'oath_accepted';
      const OATH_COOKIE_DURATION = 3 * 24 * 60 * 60 * 1000;
      
      function getCookie(name) {
        const value = '; ' + document.cookie;
        const parts = value.split('; ' + name + '=');
        if (parts.length === 2) return parts.pop().split(';').shift();
        return null;
      }
      
      function setCookie(name, val, duration) {
        const expires = new Date(Date.now() + duration).toUTCString();
        document.cookie = name + '=' + val + '; expires=' + expires + '; path=/; SameSite=Strict';
      }
      
      if (!getCookie(OATH_COOKIE_NAME)) {
        oathModal.classList.add('show');
        document.body.style.overflow = 'hidden';
      } else {
        oathModal.style.display = 'none';
      }
      
      oathCheck.addEventListener('change', () => {
        oathAgree.disabled = !oathCheck.checked;
      });
      
      oathAgree.addEventListener('click', () => {
        if (oathCheck.checked) {
          setCookie(OATH_COOKIE_NAME, 'accepted', OATH_COOKIE_DURATION);
          oathModal.classList.remove('show');
          document.body.style.overflow = '';
          soundManager.playSound('success');
          showToast('شكراً لمتابعتك! 🙏', 'success');
        }
      });
    }

    initApp();
  </script>
</body>
</html>
